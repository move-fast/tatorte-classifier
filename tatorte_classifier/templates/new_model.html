<!DOCTYPE html>
<html lang="en">

<head>
    <!-- Compiled and minified CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">

    <!-- Compiled and minified JavaScript -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
    <title>New Model</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>

<body>
    <h1>New Model</h1>
    <script>

        function train_model() {
            classifier = document.getElementById("clf").value
            vect_params = { "ngram_range": [parseInt(document.getElementById("ngram_1").value), parseInt(document.getElementById("ngram_2").value)] }
            values_per_category = parseInt(document.getElementById("values_per_category").value)
            test_size = parseFloat(document.getElementById("test_size").value)
            formElement = document.getElementById("clf_options")
            clf_options_iterator = new URLSearchParams(new FormData(formElement)).entries()
            var clf_params = {}
            for (var i of clf_options_iterator) {
                if (parseFloat(i[1]) == i[1]) {
                    clf_params[i[0]] = parseFloat(i[1])
                } else if (parseInt(i[1]) == i[1]) {
                    clf_params[i[0]] = parseInt(i[1])
                } else if (i[0] == "hidden_layer_sizes") {
                    clf_params[i[0]] = i[1].split(" ").map(Number)
                } else {
                    clf_params[i[0]] = i[1]
                }
            }
            params = { "clf": classifier, "vect_params": vect_params, "clf_params": clf_params, "test_size": test_size, "values_per_category": values_per_category }
            console.log(params)

            const Http = new XMLHttpRequest();
            Http.open("POST", "/api/models");
            Http.setRequestHeader("Content-type", "application/json");
            Http.send(JSON.stringify(params));
        }

        function change_options() {
            document.getElementById("clf_options").innerHTML = ""
            const Http = new XMLHttpRequest();
            model_name = document.getElementById("clf").value
            const url = '/api/model_options/' + model_name;
            Http.open("GET", url);
            Http.send()
            Http.onreadystatechange = function () {
                if (this.status == 200 && this.readyState == 4) {
                    options = JSON.parse(Http.response)
                    console.log(options)
                    for (var key in options) {
                        console.log(typeof options[key])
                        if (typeof options[key] == "number") {
                            document.getElementById("clf_options").innerHTML += "<div class='input-field col s6'><label>" + key + "</label><input type='number' name='" + key + "'step='0.000001' value=" + options[key] + "></div>"
                        } else if (typeof options[key] == "object") {

                            document.getElementById("clf_options").innerHTML += "<select class='browser-default' name='" + key + "' id='dropdown-" + key + "'></select>"
                            for (i = 0; i < options[key].length; i++) {
                                console.log(options[key][i])
                                document.getElementById("dropdown-" + key).innerHTML += "<option value='" + options[key][i] + "'>" + options[key][i] + "</option>"
                            }
                        } else {
                            document.getElementById("clf_options").innerHTML += "<div class='input-field col s6'><label>" + key + "</label><input type='text' name='" + key + "'value='" + options[key] + "'></div>"
                        }
                    }
                }
            }
        }
    </script>
    <select onchange="change_options()" id="clf" class="browser-default">
        <option value="" disabled selected>Choose your option</option>
        <option value="sgd">SGD</option>
        <option value="svm">SVM</option>
        <option value="nn">NN</option>
    </select>
    <br>
    <form id="clf_options">

    </form>
    <br>
    <div id="vect_options">
        <div class='input-field col s6'><label>ngram_range 1</label><input type='number' step='1' id="ngram_1"
                value="1"></div>
        <div class='input-field col s6'><label>ngram_range 2</label><input type='number' step='1' id="ngram_2"
                value="4"></div>
    </div>
    <br>
    <div class='input-field col s6'><label>Values per category</label><input type='number' step='1'
            id="values_per_category" value="900">
    </div>
    <div class='input-field col s6'><label>Test Size</label><input type='number' max="1" min="0" step='0.01'
            id="test_size" value="0.3"></div>
    <br>
    <button onclick="train_model()" class="waves-effect waves-light btn-large">Train Model</a>

</body>

</html>